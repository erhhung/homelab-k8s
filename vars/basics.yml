# standard IETF BCP 47 notation
system_locale: en-US
# Linux uses '_' instead of '-'
system_locale_linux: "{{ system_locale | replace('-','_') }}.UTF-8"
system_time_zone: America/Los_Angeles

# adjust Linux kernel parameters:
# https://www.enginyring.com/en/blog/a-guide-to-tuning-kernel-parameters-with-sysctl-in-linux
# run "sysctl -a" to see current values
sysctl:
  - key: fs.file-max
    value: 2097152
  # bump inotify limits to prevent error:
  # "watcher create: too many open files"
  - key: fs.inotify.max_user_instances
    value: 2048 # default=128
  - key: fs.inotify.max_user_watches
    value: 1048576 # default=171090
  - key: fs.inotify.max_queued_events
    value: 65536 # default=16384
  - key: vm.max_map_count
    value: 262144 # default=65530
  - key: net.core.somaxconn
    value: 16384 # default=128

# adjust process resource limits:
# https://www.man7.org/linux/man-pages/man5/limits.conf.5.html
# https://docs.ansible.com/ansible/latest/collections/community/general/pam_limits_module.html
# run "ulimit -a" to see limits; run "sysctl fs.file-nr"
# to see current usage (output values are used/free/max)
pam_limits:
  nofile:
    type: "-"
    domain: "*"
    value: 1048576

# only necessary if hosts are not rebooted after
# drivers get installed by packages.yml playbook
# run "lsmod | grep <driver>" to check if driver
# is loaded
modprobe:
  - i915

host_pif: enX0 # XCP-ng VM physical interface
subnet_mask: /24
name_servers:
  # first IP address used as default gateway
  - 192.168.0.1
  - 1.1.1.1
  - 1.0.0.1

add_user_to_groups:
  - user: "{{ ansible_user }}"
    groups:
      - render # access /dev/dri/ by clinfo
    # GPU passthrough enabled hosts
    hosts: ["k8s2", "k8s3", "k8s4"]

# <name>,[user|group],[runas],
# [setenv:bool],[commands=ALL]
sudoers_rules:
  - name: sudo-env-keep
    group: sudo
    setenv: true
